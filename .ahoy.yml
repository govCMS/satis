ahoyapi: v2
usage: CLI utilities
commands:

  satis:
    usage: Execute composer/satis via docker.
    cmd: |
      docker run --rm --init -it \
        --volume $(pwd):/build \
        --volume "${COMPOSER_HOME:-$HOME/.composer}:/composer" \
        composer/satis "$@"

  satis-build:
    usage: Execute composer/satis passing in a json and a build dir.
    cmd: |
      docker run --rm --init -it \
        --user $(id -u):$(id -g) \
        --volume $(pwd):/build \
        --volume "${COMPOSER_HOME:-$HOME/.composer}:/composer" \
        composer/satis build -vvv "$1" /build/"$2"
      docker run --rm --init -it \
        --volume $(pwd):/build \
        composer/satis /build/scripts/branding.sh "/build/$2"

  build:
    usage: Build everything in /app
    cmd: |
      ahoy build-stable
      ahoy build-master
      ahoy build-develop
      ahoy build-whitelist

  build-stable:
    usage: Build satis.govcms.gov.au
    cmd: |
      ahoy satis-build satis-config/govcms-stable.json app

  build-master:
    usage: Build satis.govcms.gov.au/master
    cmd: |
      ahoy satis-build satis-config/govcms-master.json app/master

  build-develop:
    usage: Build satis.govcms.gov.au/develop
    cmd: |
      ahoy satis-build satis-config/govcms-develop.json app/develop

  build-whitelist:
    usage: Build satis.govcms.gov.au/whitelist
    cmd: |
      ahoy satis-build satis-config/govcms-whitelist.json app/whitelist

  verify:
    usage: Locally run the same tests that would run in circle.
    cmd: |
      ahoy verify-stable
      ahoy verify-master
      ahoy verify-develop

  verify-stable:
    usage: Verify the stable satis.
    cmd: |
      SATIS_BUILD=app ./scripts/verify.sh

  verify-master:
    usage: Verify the stable satis.
    cmd: |
      SATIS_BUILD=app ./scripts/verify.sh master

  verify-develop:
    usage: Verify the stable satis.
    cmd: |
      SATIS_BUILD=app ./scripts/verify.sh develop

  debug:
    usage: Get clear information about satis issues.
    cmd: |
      ahoy debug-stable
      ahoy debug-master
      ahoy debug-develop

  debug-stable:
    usage: Verify the stable satis.
    cmd: |
      SATIS_BUILD=app ./scripts/check-missing.sh
      SATIS_BUILD=app ./scripts/check-dupes.sh

  debug-master:
    usage: Verify the stable satis.
    cmd: |
      SATIS_BUILD=app ./scripts/check-missing.sh master
      SATIS_BUILD=app ./scripts/check-dupes.sh master

  debug-develop:
    usage: Verify the stable satis.
    cmd: |
      SATIS_BUILD=app ./scripts/check-missing.sh develop
      SATIS_BUILD=app ./scripts/check-dupes.sh develop

  server:
    usage: Make satis available on localhost:4142
    cmd: |
      PHP -S localhost:4143 -t app
